--liquibase formatted sql
--changeset table_script:SVT_COMPONENT_TYPES stripComments:false runOnChange:true
--preconditions onFail:MARK_RAN onError:HALT
--precondition-sql-check expectedResult:0 select count(1) from all_tables where upper(table_name) = upper('SVT_COMPONENT_TYPES');
------------------------------------------------------------------------------
--  Creator: Hayden Hudson
--     Date: May 25, 2023
-- Synopsis:
--
-- This table is designed to house the components from WWV_FLOW_DICTIONARY_VIEWS,
-- to which I am linking from my tests
--
-- merge into svt_component_types e
-- using (select id, view_name, parent_view_id, pk_column_name, display_expression, component_type_id, link_url 
--        from apex_230100.wwv_flow_dictionary_views) h
-- on (e.component_name = h.view_name)
-- when matched then
-- update set e.fdv_id = h.id,
--            e.fdv_parent_view_id = h.parent_view_id,
--            e.component_type_id = h.component_type_id,
--            e.template_url = h.link_url
-- when not matched then
-- insert (e.fdv_id, e.component_name, e.fdv_parent_view_id, e.pk_value      , e.name_column       , e.component_type_id, e.template_url, e.friendly_name,  e.available_yn, e.nt_type_id, e.created, e.created_by, e.updated, e.updated_by)
-- values (h.id    , h.view_name     , h.parent_view_id    , h.pk_column_name, h.display_expression, h.component_type_id, h.link_url    , h.pk_column_name, 'N'           , 41, systimestamp,user,systimestamp,user);
------------------------------------------------------------------------------
create table svt_component_types (
  id                 number generated by default on null as identity,
  component_name     varchar2(50 char) not null,
  available_yn       varchar2(1 char) not null,
  nt_type_id         number not null, 
  pk_value           varchar2(50 char),
  parent_pk_value    varchar2(50 char),
  template_url       varchar2(250 char),
  friendly_name      varchar2(50 char) not null,
  name_column        varchar2(100 char) not null,
  addl_cols          varchar2(1000 char),
  component_type_id  number,
  fdv_id             number,
  fdv_parent_view_id number,
  created            timestamp (6) with local time zone default systimestamp not null,
  created_by         varchar2(255 char)                 default user not null,
  updated            timestamp (6) with local time zone default systimestamp not null,
  updated_by         varchar2(255 char)                 default user not null
)
/
alter table svt_component_types add component_type_id  number;
alter table svt_component_types add fdv_id             number;
alter table svt_component_types add fdv_parent_view_id number;
/
alter table svt_component_types add constraint uk_componentname unique(component_name)
/
alter table svt_component_types add constraint svt_component_types_pk primary key (id)
/
create index svt_component_types_idx1 on svt_component_types (nt_type_id)
/
--rollback drop table SVT_COMPONENT_TYPES;